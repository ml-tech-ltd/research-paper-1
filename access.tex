\documentclass{ieeeaccess}
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithm}
\usepackage{algorithmicx}
\usepackage{algpseudocode}
%% \usepackage{caption}
\usepackage{graphicx}
\usepackage{textcomp}

\usepackage{multirow}

\usepackage{array}
\setlength\extrarowheight{3pt}

\providecommand{\e}[1]{\ensuremath{\times 10^{#1}}}

\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}
\history{Date of publication xxxx 00, 0000, date of current version xxxx 00, 0000.}
\doi{10.1109/ACCESS.2017.DOI}

\title{Using Intuitionistic Fuzzy Inference Systems For the Creation
of an Agent-based Financial Market Model}
\author{
  \uppercase{Amaury Hernandez-Aguila\authorrefmark{1}
    and
    \uppercase{Mario Garcia-Valdez\authorrefmark{2}}}}
%% TODO: Check correct address. Can we use a single authorrefmark for
%% both authors?
\address[1]{National Institute of Standards and 
Technology, Boulder, CO 80305 USA (e-mail: author@boulder.nist.gov)}
\address[2]{Department of Physics, Colorado State University, Fort Collins, 
  CO 80523 USA (e-mail: author@lamar.colostate.edu)}
%% TODO: Grant information.
\tfootnote{This paragraph of the first footnote will contain support 
information, including sponsor and financial support acknowledgment. For 
example, ``This work was supported in part by the U.S. Department of 
Commerce under Grant BS123456.''}

%% TODO: What is this?
\markboth
{Author \headeretal: Preparation of Papers for IEEE TRANSACTIONS and JOURNALS}
{Author \headeretal: Preparation of Papers for IEEE TRANSACTIONS and JOURNALS}

\corresp{Corresponding author: Amaury Hernandez-Aguila (e-mail: amherag@tectijuana.edu.mx).}

\begin{abstract}
%% Highlights:
%% * The proposed method uses a multi-agent system for the creation of
%% financial market forecasting agent-based models.
%% * Intuitionistic fuzzy systems are used to model agents' knowledge.
%% * The resulting predictive models can be interpreted to obtain additional
%% insight about the financial markets they are modelling.
%% * The resulting predictive models are competent for the forecasting of
%% market prices.

Many methods for the creation of financial market models exist, such as linear
regression and neural networks. However, the models created by many of these
methods provide little to no additional insight regarding the problem they are
modeling---one can contrast the models generated by neural networks against
those produced by decision trees, as an example. The models created by the
method proposed in this paper, in addition to the expected forecasting of
market prices, can be examined to provide possible explanations of how the
prices of a market are reached. The proposed method uses a multi-agent system % formed? changed to reach -Mario  
where agents' rules are modeled using intuitionistic fuzzy systems. This new
approach allows the compilation of model interpretations for financial markets
from both macro and micro perspectives, as one can draw inferences about how
both the interaction among the agents and each agent's knowledge
affect the prices of a market. In addition to its interpretation capabilities,
the proposed method demonstrates its efficacy for the creation of competent
predictive models. 
% Need to talk about the experimental results and validation.
% I am not sure about the first paragraph, this problem is well known 
% so the fact that models can be human-readable must not be the main 
% contribution, I think the multi-agent and intuition part is more important.
% - Mario

\end{abstract}

\begin{keywords}
  %% TODO: Review keywords.
  %% I'm already using kewords from
  %% http://www.ieee.org/organizations/pubs/ani_prod/keywrd98.txt
decision support systems, economic forecasting, fuzzy systems,
multi-agent system
\end{keywords}

\titlepgskip=-15pt

\maketitle

\section{Introduction}
\label{section:introduction}

% * I describe what a market is.

% * Knowing the mechanics behind a market is hard.
% * But we can create models.
% * Examples of prediction techniques (cite).

% * Better approach is technical indicators, but needs interpretation.
% * Better is ANN, but can't be interpreted.
% * Agent-based models are interpretable and perform well.
% * Also, agent-based models can be fed technical indicators (as beliefs).
% * Explains that agents' beliefs and rules can use fuzzy logic.

%% Amaury: Tweak introduction following highlights.

% The interaction of many traders constructs a financial market.  A
% trader is an entity that can buy or sell a number of units of an
% asset. Traders can either be individual human beings, organizations,
% or even computer programs. An asset can be anything that can be priced
% and can be divided so different parties can hold a share of the
% asset. For example, corn can be priced, and different parties can hold
% a share of the corn market by physically owning corn. Lastly, traders
% can decide to either buy or sell shares of this asset. Although this
% decision can seem simple, as there can only be two outcomes, the
% process a trader can follow in order to arrive at an outcome can be
% very complicated.

% One can create models that closely simulate a financial market, and
% one can assume that these simulations are generalizations of the real
% financial market. Several approaches have been taken in the past to
% create such models with varying success. One of the simplest methods
% to forecast the prices in a financial market is linear % % Amaury:
% Maybe use a more recent example. It %% doesn't matter if we change the
% technique.  regression~\cite{kutner2004applied}, where we try to find
% a function of the form $f(x) = a + bx$---or simply a linear
% function---that minimizes the distance between the points in the line
% and the points that represent the prices. Even though linear
% regression can provide valuable insight, such as determining the
% general direction of a market in a determined period, it is not
% suitable to be taken as a complete solution to forecasting.

One can create models that closely simulate a financial market, and
one can assume that these simulations are generalizations of the real
financial market. Furthermore, these models can
be used to extrapolate the prices of a market as a forecasting
method. The prices of a financial market can be forecasted using
different techniques, such as the analysis of raw data or news
involving the financial markets of interest \cite{Liu2019}, or raw
data can be preprocessed using technical indicators
\cite{Alsubaie2019} or news can be analyzed using sentiment analysis
\cite{LienMinh2018} \cite{Cabrera2018}. Predictive models can be
created using statistical tools such as ARIMA \cite{Idrees2019} or
Hidden Markov Models \cite{Cao2019}. Machine learning techniques can
be applied to perform the forecasting process, such as support vector
machines \cite{Guo2018}, neural networks \cite{Chen2019a} or fuzzy
logic \cite{Jiang2018}. Instead of performing a simple forecasting of
a financial market, there are works that focus on the recommendation
of a portfolio of financial markets to invest in
\cite{Chen2019b}. However, the work presented in this paper focuses on
forecasting the prices of financial markets, and we selected a set of
machine learning techniques to create predictive models.

The work presented in this paper focuses on fuzzy logic and its
implementation through fuzzy systems. The use of fuzzy logic enables
the method to present results to the user that are easily
interpretable, especially if Mamdani fuzzy sets \cite{Mamdani1975} are
used to create the membership functions of a fuzzy system, as in the
work of Abdulgader and Kaur \cite{Abdulgader2019}. In particular, the
presented work uses intuitionistic fuzzy logic (IFL)
\cite{Atanassov1986} \cite{Atanassov2003}, as IFL adds another layer
of interpretability for the fuzzy systems through the concept of
indeterminacy. Although there are alternatives to IFL, such as type-2
fuzzy systems, the defuzzification of IFL systems can be faster than
the aforementioned systems \cite{Hernandez-Aguila2016}, while also
providing comparable interpretability.

Fuzzy logic has proved to be useful in many fields, and one can find
many works involving financial market prediction using fuzzy systems,
such as the works by Tsai et al. \cite{Tsai2019} and Zeng et
al. \cite{Zeng2019}, where fuzzy time-series are used to perform the
predictions; as in the works by Rajab and Sharma \cite{Rajab2019} and
Vlasenko et al. \cite{Vlasenko2019}, where a neuro-fuzzy approach is
taken; or as in the works by Yue et al. \cite{Yue2019},
Witayakiattilerd \cite{Witayakiattilerd2019} and Mansour et
al. \cite{Mansour2019}, where fuzzy logic is used to perform a
portfolio selection of financial markets.

The present work uses fuzzy systems in combination with multi-agent
systems to create a model of a market, where the agents in the
multi-agent system represent the traders, and the trades performed by
these traders are used to simulate the real prices of a market.
Multi-agent systems (MAS) have been demonstrated to be an effective
approach to simulate very complex systems, such as those represented
by financial markets \cite{Lebaron2001} \cite{Grothmann2002}
\cite{Li2014} \cite{Chen2004} \cite{Kim2018}. Additionally, the agents
in the MAS can be examined to understand how individual traders are
interacting in a financial market \cite{Wei2014} \cite{Rajab2019}, and
MAS provide architectures that can be executed in a distributed manner
\cite{Gao2019} \cite{Yu2015} \cite{Yu2015}. For this work, fuzzy
systems are used to construct the agents' rules, which represent the
trading strategies used by each agent.

% In theory, if one can know all the variables that each trader is taking into
% consideration to make their particular decisions, we could predict the prices in a financial
% market. Obviously, this is near impossible, unless we
% were simulating a financial market with a handful of people and everyone was
% telling everyone else what decisions they are going to be taking. Nevertheless,
% one can create models that closely simulate a financial market, and one can
% assume that these simulations are generalizations of the real financial
% market. Several approaches have been taken in the past to create such models
% with varying success. One of the simplest methods to forecast the prices in a
% financial market is linear % % Amaury: Maybe use a more recent example. It
% %% doesn't matter if we change the technique.
% regression~\cite{kutner2004applied}, where we try to find a function of
% the form $f(x) = a + bx$---or simply a linear function---that minimizes the
% distance between the points in the line and the points that represent the
% prices. Even though linear regression can provide valuable insight, such as
% determining the general direction of a market in a determined period, it
% is not suitable to be taken as a complete solution to forecasting.

%% 

% %% I talk too much about technical analysis. I can jump directly to talking
% %% to other works.
% A better approach to using mathematical formulas to forecast a financial market
% is to use technical indicators such as the relative strength index or the
% commodity selection index~\cite{Wilder1978}. We use these technical indicators %% We don't use these anymore. Check past version.
% to perform a technique called technical analysis, where we try to identify
% what are going to be the future price movements of a market relying solely on
% the historical prices of the market we are analyzing. For example, if a market's
% ;prices have been increasing relatively too much in a relatively short time,
% according to technical analysis, this market is now considered
% \textit{overbought}, and the prices could start to fall violently at any
% moment. It is worth noting that these analyses are often subject to
% interpretation, i.e., they are subjective analyses. Additionally, these analyses
% are heuristic, as the trader's experience is heavily involved in the
% interpretation of the results obtained by the technical indicators.

% %% I'm focusing this and the last paragraph to introduce interpretation.
% %% It's too much content for that one feature.
% One method that does not need interpretation, unlike technical analysis, and
% that creates a model that tries to simulate a financial market, like linear
% regression, is artificial neural networks (ANN). We can create ANN-based models by
% using a series of data points---in the case of financial markets these data
% points are historical prices---as a training set, which we can use to adjust
% weights of the connections between neurons in the ANN. In the end, an ANN is just a
% very complex mathematical formula that, given an input, one obtains an output,
% which in the case of a financial market, that output is a price at a given
% time. Although ANNs can generate models that successfully simulate financial
% markets, interpreting the model is sometimes desired, as one can obtain insight
% that can help to understand a market's behavior better, and ANNs are not 
% designed to accomplish this goal.

% %% "Two criteria" and I never mention the second criterion. Or, rather, I do but in
% %% a separate sentence.
% Agent-based models satisfy two criteria: they are interpretable, as one can
% examine which are the rules and beliefs that conveyed an agent to a particular
% decision. Moreover, they can simulate a financial market, which helps to provide a
% model that is closely related to that market's behavior, unlike technical
% indicators. %
% % Amaury: re-think the "unlike technical indicators". Is this true?
% Furthermore, an agent-based model can use the outputs from several
% technical indicators as inputs from the environment,
% instead of using the raw historical prices. This change already implies that
% agent-based models can act at a higher order of complexity than technical
% indicators. For example, we can pre-process the historical prices of a financial
% market using technical indicators, and these will serve as the basis for
% the agents' beliefs, such as believing if a market is overbought or oversold, or %%
% if the volatility is too high or too low.

% The representation of an agents' beliefs and rules can be achieved through
% traditional (Boolean) logic, for example \textit{if the relative strength index is
% greater than 20, then buy}. Nevertheless, fuzzy logic can help to achieve a
% higher level of detail for the creation of the agents' rules and beliefs. The
% rule in the example above can then be extended to \textit{if relative strength
% index is low, then buy a big lot}. As can be noted, just as one can use fuzzy
% logic to create fuzzy inference systems, the agents' actions can also be
% represented by fuzzy rules. % A comment on fuzzy in the paper - Mario

% We should connect the above concepts to current research and methods,
% they are novel?, what is the new proposal?  
% The X method proposed by A has this advantage, and add references to related work.
% like a very short state of the art. Mainly showing previous success of the methods
% in other areas or problems like this. - Mario    

The preceding paragraphs serve as a description of the motivation behind the
proposed method in this work: using fuzzy inference systems for the creation of
agent-based models. % Elaborate this - Mario 
However, the reader will find in Section~\ref{section:proposed-method} that the proposed method does not use traditional
fuzzy systems, but intuitionistic fuzzy systems~\cite{Atanassov1986}, which have
the objective of better representing the knowledge and decisions of a human
trader. Before better examining the method for constructing such agent-based
models, a series of related works is presented in Section
\ref{section:state-of-the-art}, which helps the reader to understand the advantages
that the proposed method in this work provides in contrast to other already
existing techniques. After understanding the theoretical background of the
method, the reader can find an implementation of the method in Section
\ref{section:implementation}.
%
% Amaury: Explain structure of the paper.

% Amaury: Explain that we get good results too (competent results is one of the highlights).

\section{Preliminaries}
\label{section:preliminaries}
%
% Amaury: Maybe reduce the length of this section.

This Section describes the concepts that the reader needs to be familiar with in
order to better understand the proposed method in Section
\ref{section:proposed-method}.% If the reader is already familiarized with any
%% of the concepts discussed below, it can be omitted.
% Amaury: I don't know if it sounds weird to say it can be omitted.

\subsection{Fuzzy Sets}
\label{subsection:fuzzy-sets}

A traditional set is a collection of items that share a common
characteristic. This characteristic serves as a membership, because all the
items in a universe either have that characteristic---and then the item is
part of the set---or it does not have it---and then the item is not part of
the set. Traditional sets can be extended to fuzzy sets, as explained by
Zadeh~\cite{Zadeh1965}.
Fuzzy sets are then a generalization of traditional sets,
i.e.\ any traditional set can be represented as a fuzzy set. The difference
between these two type of sets lies in the concept of membership: memberships
are not only used to represent binary outcomes, i.e. \textit{true} or
\textit{false}, but now a possibly infinite number of outcomes. An item can now
be partially a member of a set, and the only way an item is not part of such set
is if its membership is totally \textit{false}. In order to represent this grade
of membership one can use real numbers. Thus, one can say, for example, that an
item is \textit{0.7 green}, \textit{0.5 blue} and \textit{0.0 red}. These values
can represent an adverb and an adjective, such as ``very green,'' ``somewhat
blue'' and ``not red at all.'' This is especially useful when designing fuzzy
systems (see Subsection \ref{subsection:fuzzy-systems}).

\subsection{Fuzzy Systems}
\label{subsection:explaining-fuzzy-systems}

%% TODO: Linguistic hedges are often associated to these multiple membership
%% functions to describe them in a more comprehensible way.

In traditional logic one can generate logical inferences, such as \textit{if
it's raining, then there are clouds in the sky}. In a similar fashion, one can
use fuzzy sets to represent the antecedents and consequents in a logical
inference process. For example, one can extend the previous example to:
\textit{if it's raining a lot, then there are many clouds in the sky}.

There is a number of ways in which one can construct a fuzzy inference system,
where one or more inputs or antecedents can be used to generate one or more
outputs or consequents. Arguably, the two most popular types of fuzzy inference
systems are the ones created by Mamdani and Assilian~\cite{Mamdani1975}, and
Takagi and Sugeno~\cite{Takagi1985}. These systems use a series of fuzzy sets to
represent the relationship between an input and its grade of membership to a
set. These sets usually represent adjectives that describe the inputs, and are
also considered to be the antecedents in the fuzzy inference system. For
example, an input of 0.8 can represent a ``very high'' value. After obtaining
these grades of membership, one can use these values to ``fire'' or ``activate''
the consequents. In the case of a Mamdani system, the consequents are
represented as fuzzy sets, just like the antecedents. In contrast, in a Sugeno
system, consequents are represented by mathematical functions. A set of rules is
used to determine the relationship between the antecedents and the consequents,
for example: \textit{if food quality is high then tip is high}. The
aforementioned rule is creating a relationship between the fuzzy set that
represents ``high food quality'' in the antecedents, and the fuzzy set that
represents ``high tip'' in the consequents. Further continuing with the example,
if ``food quality'' is represented by a value of 0.8, the rule that creates the
relationship between ``food quality'' and ``tip'' could determine a ``tip'' of
0.8 too, depending on what membership function and what parameters are decided
to be used to represent each.

It has been explained how a relationship between antecedents and consequents can
be constructed in a fuzzy inference system. Nevertheless, the most interesting
problem arises when a problem involves several fuzzy sets to represent different
adjectives for single antecedents or consequents. In these cases, depending on
the fuzzy rules, a number of consequents can be fired according to the inputs to
the system. As seen in Figure \ref{figure:antecedents}, the input---represented
by the dotted vertical black line---is associated with three fuzzy
triangular sets or antecedents, where it ``activates'' two of them. According to
a set of fuzzy rules, it then fires a set of triangular fuzzy sets that
represent the consequents, as seen in Figure \ref{figure:consequents}.

The fuzzy sets that represent the consequents are cut, and new shapes are
obtained using those cuts, as represented by the green shapes in Figure
\ref{figure:consequents}. These shapes are aggregated and result in the output
of the fuzzy inference system, and this result can then be defuzzified using
different methods, such as obtaining the centroid of the shape. In this example,
a Mamdani fuzzy inference system is considered; in the case of a Sugeno system,
for example, the antecedents would be represented by arbitrary mathematical
functions, instead of membership functions representing shapes such as the
triangles in the example presented above.

\Figure[](topskip=0pt, botskip=0pt, midskip=0pt)
[width=0.6\linewidth]
{img/antecedents.png}
{Example of antecedents in a Mamdani fuzzy system.
  \label{figure:antecedents}}

\Figure[](topskip=0pt, botskip=0pt, midskip=0pt)
[width=0.6\linewidth]
{img/consequents.png}
{Example of consequents in a Mamdani fuzzy system.
  \label{figure:consequents}}

\subsection{Intuitionistic Fuzzy Sets}
\label{subsection:intuitionistic-fuzzy-sets}

In contrast to the traditional fuzzy sets discussed in Subsection
\ref{subsection:fuzzy-sets}, intuitionistic fuzzy sets consider a grade of
non-membership in addition to a grade of membership associated to an element in
the fuzzy set, as expressed by \ref{eq:ifs-definition}.

% intuitionistic fuzzy set
\begin{equation}
  \label{eq:ifs-definition}
  A^{*} = \{\langle x, \mu _{A} (x), \nu _{A} (x) \rangle | x \in E\}
\end{equation}

For every of the elements contained in an intuitionistic fuzzy set,
\ref{eq:intuitionistic-interval} must hold true.

% intuitionistic interval
\begin{equation}
  \label{eq:intuitionistic-interval}
  0 \leq \mu_{A}(x) + \nu_{A}(x) \leq 1
\end{equation}

Intuitionistic fuzzy sets are an extension to traditional fuzzy sets, as any
traditional fuzzy set can be expressed as a particular case of an intuitionistic
fuzzy set, as in \ref{eq:ifs-form}.

% every ordinary fuzzy set has the form
\begin{equation}
  \label{eq:ifs-form}
  \{ \langle x, \mu_{A}(x), 1 - \mu_{A}(x) \rangle | x \in E \}
\end{equation}

If the sum of the membership $\mu_{A}(x)$ and non-membership $\nu_{A}(x)$ of an
element is less than $1$, the concept of indeterminacy or hesitancy arises,
which is described by \ref{eq:indeterminacy}. Indeterminacy is used to represent
doubt in the grade of membership of an element in an intuitionistic fuzzy set
and is described by \ref{eq:indeterminacy}.

% if
\begin{equation}
  \label{eq:indeterminacy}
  \pi_{A}(x) = 1 - \mu_{A}(x) - \nu_{A}(x)
\end{equation}

Traditional fuzzy sets can be extended to increase their capabilities of
representing uncertainty by introducing the concept of footprint of
uncertainty. A footprint of uncertainty is achieved by extending the membership
function, where each of its values are now fuzzy sets themselves, instead of
crisp values. Indeterminacy serves a different purpose than the one of footprint
of uncertainty. Instead of extending the uncertainty provided by traditional
fuzzy sets, indeterminacy helps to model doubt. For example, if traditional
fuzzy sets can model the following sentence: ``the object is very hot'',
indeterminacy can model ``it is unsure that the object is very hot''.

\Figure[](topskip=0pt, botskip=0pt, midskip=0pt)
[width=0.6\linewidth]
{img/fs-as-ifs.pdf}
{Traditional fuzzy set represented as an intuitionistic fuzzy set.
  \label{figure:fs-as-ifs}}

\Figure[](topskip=0pt, botskip=0pt, midskip=0pt)
[width=0.6\linewidth]
{img/ifs-diff-mu-sd.pdf}
{Intuitionistic fuzzy set with membership and non-membership functions with different means and standard deviations.
  \label{figure:ifs-diff-mu-sd}}

\subsection{Intuitionistic Fuzzy Systems}
\label{subsection:intuitionistic-fuzzy-systems}

Intuitionistic fuzzy sets, like traditional fuzzy sets, can be used to create
inference systems. Antecedents and consequents in the system can be handled by
intuitionistic fuzzy sets, as in a Mamdani system~\cite{Mamdani1975}, or only
the antecedents and use mathematical functions for the consequents as in a
Sugeno system~\cite{Takagi1985}.

Different approaches have been taken in the past by different authors on how to
build intuitionistic fuzzy systems. The authors of the present paper have worked
in a particular way of achieving this type of systems, and the method is
described in~\cite{Hernandez-Aguila2016} and~\cite{Hernandez-Aguila2017-2}. The
method described in the aforementioned works is presented in this Subsection for
the reader as a reference implementation.

% handle inputs
% alpha-cuts
% defuzzification

As is explained in~\cite{Hernandez-Aguila2016}, in an IFIS, in order for an
antecedent to fire a consequent according to a set of fuzzy rules, the final
grade of membership of an element has to be expressed in terms of its grade of
membership and its grade of non-membership. The resulting grade of membership of
an element of $A$ is represented by $i\mu_{A}(x)$, and is defined in
(\ref{imembership}).

% i-membership
\begin{equation}
  \label{imembership}
  i\mu_{A}(x) = (\nu_{A}(x) + \mu_{A}(x))\mu_{A}(x)
\end{equation}

To perform an alpha-cut in a consequent, one has to separate it in two stages:
1) perform a traditional alpha-cut in the membership function following equation
(\ref{alpha-cut}), and then 2) perform an alpha-cut in the non-membership
function following equation (\ref{nmf-alpha-cut}).

\begin{equation}
  \label{alpha-cut}
  \alpha(\mu (x),\mu_{\alpha}) =
  \begin{cases}
    \mu (x), & \text{if}\ \mu (x) \leq \mu_{alpha}  \\
    \mu_{\alpha}, & \text{otherwise}
  \end{cases}
\end{equation}

\begin{equation}
  \label{nmf-alpha-cut}
  \alpha_{NMF}(\nu (x),\mu_{\alpha}) =
  \begin{cases}
    \nu (x), & \text{if}\ \nu (x) \geq \nu (\mu_{alpha})  \\
    \nu (\mu_{alpha}), & \text{otherwise}
  \end{cases}
\end{equation}

The aggregation of the fired consequents is performed by applying
(\ref{union-operator}) on the alpha-cuts.

\begin{equation}
  \label{union-operator}
  \begin{aligned}
    A \cup B  = &\{ \langle x, max(\mu_{A} (x), \mu_{B} (x)),\\
    &\quad min(\nu_{A} (x), \nu_{B} (x)) \rangle | x \in E \}
\end{aligned}
\end{equation}

The final modification to the traditional inference process in a FIS is made to
the center of area procedure. The equation to calculate the center of area of a
traditional fuzzy set is (\ref{center-of-area}). In order to implement a center
of area for an intuitionistic fuzzy set, one has to incorporate the concept of
$i\mu(x)$, giving as a result (\ref{if-coa}), and its simplification form
(\ref{if-coa-simplified}).

% CoA
\begin{equation}
  \label{center-of-area}
  A_{CoA} = \dfrac{\sum_{i=1}^{N} \mu(x_{i})
    x_{i}}{\sum_{i=1}^{N} \mu(x_{i})}
\end{equation}

%iCoA
\begin{equation}
  \label{if-coa}
  A_{iCoA} = \dfrac{\sum_{i=1}^{N} (\mu(x_{i}) + \nu(x_{i})) \mu(x_{i})
    x_{i}}{\sum_{i=1}^{N} (\mu(x_{i}) + \nu(x_{i})) \mu(x_{i})}
\end{equation}

%iCoA contracted
\begin{equation}
  \label{if-coa-simplified}
  A_{iCoA} = \dfrac{\sum_{i=1}^{N} i\mu_{A}(x) x_{i}}{\sum_{i=1}^{N}
    i\mu_{A}(x)}
\end{equation}

\Figure[](topskip=0pt, botskip=0pt, midskip=0pt)
[width=0.6\linewidth]
{img/fis-surface.png}
{Output surface for the tipping problem using a traditional fuzzy system.
  \label{figure:tipping-output-surface}}

\Figure[](topskip=0pt, botskip=0pt, midskip=0pt)
[width=0.6\linewidth]
{img/ifis-surface.png}
{Output surface for the tipping problem using an intuitionistic fuzzy system.
  \label{figure:ifis-tipping-output-surface}}

\subsection{Multi-agent Systems and Agent-based Models}
\label{subsection:multi-agent-system}

A multi-agent system is software that solves a problem using agents. Agents can
be seen themselves as programs that interact with their environment, which may
include other agents. Agents in the proposed method in this paper follow the
structure suggested by Shoham in~\cite{Shoham1993}, where agents have
beliefs and rules. Beliefs are used by agents to arrive to an interpretation of
their environment, and rules are used to arrive to actions to be performed by
the agent towards their environment. The agents in the system are constantly
sensing their environment to determine what actions to take according to their
beliefs and rules. Multi-agent systems have the objective of solving a practical
problem, unlike agent-based models which are more focused to providing a
simulation of a problem.

As mentioned before, agents can also be used to create agent-based models. These
models are used to represent a problem so a human being can analyze it and infer
new knowledge from it, or it can be used to better understand a problem.

The proposed method in this paper is both a multi-agent system and an
agent-based model. It is a multi-agent system in the sense that it can be used
to create a trading strategy, and it is an agent-based model because the agents
in the system can be analyzed to understand the state of the market that is
serving as the system's environment.

% \section{State of the Art}
% \label{section:state-of-the-art}

% \subsection{Multi-Agent Systems}
% \label{subsection:multi-agent-systems}

% \subsubsection{Fuzzy Multi-Agent Systems}
% \label{subsubsection:fuzzy-ma-systems}

% \subsection{Fuzzy Systems}
% \label{subsection:fuzzy-systems}

% \subsubsection{Intuitionistic Fuzzy Systems}
% \label{subsubsection:intuitionistic-fuzzy-systems}

% \subsection{Financial Forecasting}
% \label{subsection:financial-forecasting}

% \subsubsection{Fuzzy Systems}
% \label{subsubsection:fuzzy-systems}

% \subsubsection{Multi-Agent Systems}
% \label{subsubsection:multi-agent-systems}

\section{Proposed Method}
\label{section:proposed-method}

The proposed method involves the use of a multi-agent system which acts in a
decentralized fashion. Whereas a centralized multi-agent system depends on an
agents which coordinate the actions and communication among the agents, a
decentralized multi-agent system involves the use of agents that act
autonomously~\cite{andreadis2014classification}. However, it can be noted that
the system proposed in this paper has a mechanism that averages the output of
the agents to their environment, and another mechanism which sends the input to
the agents. Although these mechanisms can be considered characteristic of
centralized multi-agent systems, they are not particularly complex processes
compared to the rest of the processes involved in the proposed method, which are
related to decentralized multi-agent systems.

The architecture followed by the multi-agent system is based on the one proposed
by Shoham~\cite{Shoham1993}. Particularly, the method presented in this paper
adopts the idea of designing agents as a set of beliefs and rules that dictate
how agents perceive and interact with their environment.

The following Subsections describe the proposed method in
detail. Subsection~\ref{subsection:agent-architecture} describes the structure
followed by each of the agents that shape a predictive model, while
Subsection~\ref{subsection:multi-agent-system} describes how the agents in the
predictive model are coordinated and how they interact with their
environment. Finally, Subsection~\ref{subsection:meta-heuristic} describes a
meta-heuristic that finds a combination of agents that is suitable to be used
as a predictive model for particular data sets.

\subsection{Agent Architecture}
\label{subsection:agent-architecture}

Agent rules are defined by Mamdani intuitionistic fuzzy inference systems. Fuzzy systems
are convenient, as they can be interpreted, as opposed to, for example, neural
networks, where the weights associated to the neurons and the connections among
themselves become obscure to interpretation. Furthermore, the use of
intuitionistic fuzzy systems provides an additional layer for interpretation:
indeterminacy.

Indeterminacy surges as a consequent of the inclusion of non-membership to a
fuzzy system (see Subsection~\ref{subsection:intuitionistic-fuzzy-sets}). This
concept allows the designer of a fuzzy system to model doubt or hesitancy in a
data set. In the proposed method, indeterminacy is obtained in a heuristical
manner, as part of the optimization algorithm that searches for a combination of
agents that are used to create a predictive model.

The membership functions in the fuzzy systems are always defined as Gaussian
functions, although in future experiments this design choice can
change. Gaussian membership functions were chosen because of their capability of
modelling knowledge in a smoother way than their alternatives, such as
triangular or trapezoidal membership functions. Although other membership
functions can be better suited for certain situations, the proposed method is
currently designed for the creation of predictive models for arbitrary data sets,
where solutions are found using a meta-heuristic.

%% It is usual for a fuzzy rule to contain multiple membership functions to
%% describe input and output variables.

%% Amaury: Mention inputs and outputs in training data set.

In the proposed method, at least two Gaussian membership functions are used to
describe each agent rule antecedents and consequents. The mean of each Gaussian
membership function is equal to a random data point from the training data set,
while the spread of the Guassian membership functions that represent a fuzzy
rule will be equal to the standard deviation of the aforementioned randomly
chosen data points. In the case of the antecedents, the means are equal to data
points from the training data set that represent inputs, while outputs in the
training data set are used as the means for the membership functions that form
the consequents. This is expressed by
\ref{equation:membership-function-spread} and depicted in
Figure~\ref{figure:fuzzy-system-architecture}.

% TODO: Express standard deviation of randomly chosen data points.
\begin{equation}
  \label{equation:membership-function-spread}
  A_{iCoA} = \dfrac{\sum_{i=1}^{N} i\mu_{A}(x) x_{i}}{\sum_{i=1}^{N}
    i\mu_{A}(x)}
\end{equation}

\Figure[](topskip=0pt, botskip=0pt, midskip=0pt)
[width=0.6\linewidth]
{img/antecedents.png}
{Depiction of the fuzzy system architecture.
  \label{figure:fuzzy-system-architecture}}

Data points are used as the means of the membership functions as this guarantees
an agent to be able to react to at least those input values. On the other hand,
using the standard deviation of those chosen data points as the spread of the
Gaussian membership functions guarantees that uncertainties associated to each
membership function will affect---in terms of fuzzy inferences---at least one of
the other membership functions. If none of the membership functions were
affecting in any way the rest of the membership functions, the use of a fuzzy
system to represent the agent rules would be meaningless.

The domain of each membership function is not fixed as it is determined by the
chosen data points and their standard deviation. The calculation that determines
the domain of a membership function is expressed by~\ref{equation:mf-domain}, and---as a consequent of this
calculation---the domain of either the antecedents or the consequents in a fuzzy
system is expressed by~\ref{equation:ant-con-domain}. %% As can be seen in
%% the latter, the domain of both the antecedents and consequents is
%% determined by the minimum and the maximum values contained by the union of

%% Amaury: Talk about the range of the membership functions. As we're using
%% intuitionistic fuzzy sets, the core is not necessarily 1.0.

\begin{equation}
  \label{equation:mf-domain}
  A_{iCoA} = \dfrac{\sum_{i=1}^{N} i\mu_{A}(x) x_{i}}{\sum_{i=1}^{N}
    i\mu_{A}(x)}
\end{equation}

\begin{equation}
  \label{equation:ant-con-domain}
  A_{iCoA} = \dfrac{\sum_{i=1}^{N} i\mu_{A}(x) x_{i}}{\sum_{i=1}^{N}
    i\mu_{A}(x)}
\end{equation}

As the agent rules are represented by intuitionistic fuzzy systems, the core of
the membership functions is not necessarily equal to 1---or it does not exist,
if one considers the core of a membership function to be restricted to a value
of 1---, as in the case of traditional fuzzy systems. The value of the greatest
grade of membership in a membership function is determined heuristically using
an optimization algorithm that is explained in
Subsection~\ref{subsection:meta-heuristic}.

Indeterminacy is used to ``fuzzify'' activation thresholds associated to inputs
to the agent, which determine if the agent should respond to that input or
not. This way, the system uses uncertainty---coming from membership
functions---and indeterminacy---coming from non-membership functions---to model
the membership of an input and an activation function,
respectively. Considering the agent system architecture proposed by
Shoham~\cite{Shoham1993}, in the proposed method an agent's fuzzy system
represents an agent's rules, while its activation functions represent an
agent's beliefs.

Inputs to an agent's fuzzy system are associated to grades of membership---as
is usual in fuzzy inference systems---and this grade of membership can either
belong or not to an interval $\Lambda$, which is defined by~\ref{equation:activation-interval}, as seen in
Figure~\ref{figure:activation-threshold}. If the grade of membership can be
found in the interval $\Lambda$, then the agent will consider that input to be
used to fire a consequent in its agent rules. It is noteworthy that different
activation thresholds and non-membership functions can be associated to each of
the membership functions present in the antecedents of an agent's fuzzy system.

An agent's actions can be greatly limited by its activation functions, as having
a single input associated to a grade of membership which does not belong to the
activation interval $\Lambda$ is sufficient for an agent to take no action. This
behavior allows to finely control the magnitude of specialization of each agent
in a predictive model, as the designer of the model---such as a
meta-heuristic---can assign activation thresholds and non-membership functions
that restrict an agent to be activated to only a handful of inputs from a
training data set. Furthermore, activation functions work as a coordination
mechanism for the agents in a predictive model, as they prevent certain agents
from taking action in situations where they would perform sub-optimally and
others would perform optimally.

\begin{equation}
  \label{equation:activation-interval}
  A_{iCoA} = \dfrac{\sum_{i=1}^{N} i\mu_{A}(x) x_{i}}{\sum_{i=1}^{N}
    i\mu_{A}(x)}
\end{equation}

\Figure[](topskip=0pt, botskip=0pt, midskip=0pt)
[width=0.6\linewidth]
{img/antecedents.png}
{Depiction of an activation threshold in a membership function.
  \label{figure:activation-threshold}}

\subsection{Multi-agent System}
\label{subsection:mult-agent-system}

Predictive models that follow the proposed method are formed by a set
of one or more agents constructed using the architecture described in
Subsection~\ref{subsection:agent-architecture}, resulting in a multi-agent
system.

Agents must work together in order to simulate a financial market. One
way of achieving this is to obtain the output of every agent in the
predictive model and to use an aggregation process to unify them into
one single output. Instead, the proposed method uses activation
functions to restrict what agent outputs are used to respond to a set
of inputs.

The restriction imposed by the activation functions ensures that every
agent is specialized at different subsets of the training data
set. During the creation of the agent, the agent can be tested with
each of the input data points from the training data set to compile a
list of activation levels---i.e., the grades of membership associated
to each of the inputs, considering the membership functions in the
antecedents of the agent's rules. Once the list of activation levels
is compiled, the list can be sorted by using the sum of the activation
levels. After compiling the sorted list of activation levels, the proposed
method chooses one of them, from highest to lowest activation,
according to a \textit{depth} parameter. This proces is depicted in
Algorithm~\ref{algorithm:selection-of-activation-threshold}.

\begin{algorithm}
\caption{Selection of activation threshold}
    \label{algorithm:selection-of-activation-threshold}
\begin{algorithmic}[1]
    \Procedure{selection-of-activation-threshold}{$A, B$};
    \State $bel_A\gets extract\_beliefs(A)$
    \State $bel_B\gets extract\_beliefs(B)$

    \State \textbf{return} $agent(bel_{A1} + bel_{B2}, rul_{A1} + rul_{B2}),
    agent(bel_{B1} + bel_{A2}, rul_{B1} + rul_{A2})$
    \EndProcedure
\end{algorithmic}
\end{algorithm}

%% Amaury: Make sure that a formal definition of activation level is present.
%% It is a set of real numbers that represent grades of membership that act as
%% thresholds.

The chosen activation level serves as an activation threshold, as any set of
inputs that do not activate all the membership functions according to the
activation level will fail to activate the agent to take an action. As a
consequent---during the training stage of the method---any agent will be
activated to a number of inputs equal to the value of the \textit{depth}
parameter shown in Algorithm~\ref{algorithm:selection-of-activation-threshold}.

An implication of the aforementioned process is that activation functions also
create a restriction for the actions of the agents in a predictive model. This
restriction works as a coordination mechanism that ensures that not all the
agents participate at a given time during the prediction process, as certain
inputs will not trigger a response from any of the agents. In other words, the
predictive model only outputs a response if and only if the agents have learned
a pattern with a strong resemblance to certain inputs.

Although the activation functions cause the agents to be specialized at
responding to a number of inputs, an activation of multiple agents is
possible. In this case, the outputs of the agents is averaged. %% Amaury: Maybe
%% add an equation? The process is so simple, but it could help a bit for the
%% reader to find key points in the paper.

The process of agent specialization using activation functions is well suited
for the creation of predictive models where it is not desired to obtain a
response for any arbitrary set of inputs. In the case of financial market
forecasting, this is translated to a recommandation to the trade to not trade a
particular market, i.e.\ an unkown pattern is arising and the trader following
the recommendations from the predictive model should be wary.

However, it must be noted that the proposed method can be extended to the
creation of predictive models that always yield a response. This can be
achieved by selecting the agent that is closer to being activated.

%% figure:activation-threshold - Figure depicting how an input is
%% going to be associated to a membership and how this membership can
%% be considered or not, depending on the activation threshold.

\subsection{Meta-heuristic}
\label{subsection:meta-heuristic}

The sets of inputs and outputs that are used as the means of the
membership functions in the agent rules are determined randomly---as
is explained in Subsection~\ref{subsection:agent-architecture}. In
order to obtain a predictive model, a meta-heuristic is used to find
combinations of agents that generate a suitable simulation of a
financial market.

The proposed method uses a basic search algorithm that adds and/or removes
agents from a list of agents, where these agents work together to create a
simulation of the market. The list of agents begins at iteration 0 with a
single, random agent, and the following iterations randomly decide to either
add new agents or remove agents from the list. The modifications are committed
only if the addition or removal operation improves the performance of the
predictive model. This algorithm is depicted in detail in
Algorithm~\ref{algorithm:meta-heuristic}.

\begin{algorithm}
\caption{Meta-heuristic used to find a solution in the proposed method}
    \label{algorithm:meta-heuristic}
\begin{algorithmic}[1]
    \Procedure{selection-of-activation-threshold}{$A, B$};
    \State $bel_A\gets extract\_beliefs(A)$
    \State $bel_B\gets extract\_beliefs(B)$

    \State \textbf{return} $agent(bel_{A1} + bel_{B2}, rul_{A1} + rul_{B2}),
    agent(bel_{B1} + bel_{A2}, rul_{B1} + rul_{A2})$
    \EndProcedure
\end{algorithmic}
\end{algorithm}

A loss function is used to determine if a predictive model is better than
its predecessor. Although any measure of accuracy should suffice in order to provide a
comparison between models, measures that provide results that can be compared
regardless of the nature of the time series are preferred---such as mean
absolute scaled error or mean absolute percentage error---, the reason being that
users of the system can use the method to perform a portfolio selection.

%% TODO: Agents now respond to every input.
As is mentioned in Subsection~\ref{subsection:multi-agent-system}, the
resulting predictive model does not necessarily respond to every set of
inputs. This behavior is accentuated when the model is tested against a data
set that is different than the one used for the training stage of the
method---i.e., a testing data set---, as inputs from this data set could not
resemble at all any of those present in the training data set.

It is noteworthy that the meta-heuristic described in this section can be
changed to any other algorithm that can search for suitable combination of
agents.

% The proposed method is based on the fact that any financial market is
% constructed by the buy and sell orders from different traders. Agents can be
% used to represent the traders in the markets, as seen in Figure
% \ref{figure:agent-based-model}. These agents have three basic actions: buy, sell
% and hold. A market can then be constructed by using the aggregation of the
% orders from all the agents that are part of the system: if an agent buys 10
% units, the market will then go up 10 units; if an agent sells 10 units, the
% market will then go down 10 units; if an agent does not buy or sell any amount
% of units (holds), then the market will not move either up or down. After
% aggregating all the orders, a final price at a given point in time is reached,
% and the process is repeated for the next prices.

% \Figure[](topskip=0pt, botskip=0pt, midskip=0pt)
% [width=0.6\linewidth]
% {img/agent-model.pdf}
% {Agent-based model.
%   \label{figure:agent-based-model}}

% As described in Subsection
% \ref{subsection:multi-agent-systems-and-agent-based-models}, agents have beliefs
% and rules. Beliefs are used to pre-process the environment data, which in this
% case is represented by a market's price movements. For example, beliefs can
% represent the parameters used in technical indicators such as the commodity
% selection index. This means that although every agent is going to be sensing the
% same data, beliefs can be used to interpret that data differently and agents can
% act differently even if two agents are defined to have the same set of
% rules. Moreover, this approach allows the resulting agent-based model to be
% examined to infer how traders are perceiving a market and what actions take
% according to their perceptions.

% The objective of the agent system is to create a simulated market that resembles
% a real market. If this is achieved, a hypothesis arises: the beliefs and rules
% of the agents resemble those of the real traders that created the real
% market. From a multi-agent system perspective, if the agents closely simulate a
% real market, one can use the agents's actions to extrapolate the simulated
% market and to make predictions about the real market. From an agent-based model
% perspective, the agents can be examined to understand why the real market
% behaved in some way.

% The agents can be constructed manually by changing the beliefs and rules of each
% of the agents until their simulation resembles a real market. However, this
% optimization can be achieved more conveniently by using optimization
% algorithms. A genetic algorithm should be sufficient to find a combination of
% beliefs and rules for the agents. As the optimization process progresses, the
% simulated market should start approaching the real market, as shown in Figures
% \ref{figure:fitting1} and \ref{figure:fitting2}.

% \begin{figure}
% \caption{Fitting1}
% \centering
% \includegraphics[width=0.8\textwidth]{img/fitting1.png}
% \label{figure:fitting1}
% \end{figure}

% \begin{figure}
% \caption{Fitting2}
% \centering
% \includegraphics[width=0.8\textwidth]{img/fitting2.png}
% \label{figure:fitting2}
% \end{figure}

\section{Implementation}
\label{section:implementation}

The agents in the prediction models are represented as objects with
the following properties: agent's rules, which stores an
intuitionistic fuzzy system; activations, which stores the antecedents
of the fuzzy system; and activation thresholds, which stores the
levels that need to be surpassed by a set of inputs in order to
activate the agent.

Indeterminacy in an agent's fuzzy system is determined randomly and
optimal values are found with the metaheuristic described in
Subsection \ref{subsection:meta-heuristic}. In order to obtain
intuitionistic fuzzy sets where \ref{eq:intuitionistic-interval} holds
true, our implementation generates membership functions where the
greatest possible grade of membership is $M$ and non-membership
functions where the greatest possible grade of non-membership is $1 -
M$. The mean and spread of the Gaussian membership functions are
equal to the mean and spread of the Gaussian non-membership functions
in all cases.

The agents that are randomly generated for the meta-heuristic need to
pass a test before they can be considered a candidate to be part of a
predictive model. Considering a training data set, an agent's
activation functions are evaluated against the inputs set obtained
from that training data set in order to generate a set of activations,
where each activation is the equivalent of calculating the grade of
membership associated to a set of input. After performing this step,
all the activations are summed to obtain a score that represents the
intensity to which that agent reacts to that a set of inputs. This
score is defined by \ref{equation:activation-score}. The scores
associated to each set of inputs are ordered in a descending manner,
so the first elements are the scores that represent those sets of
inputs that would fire an agent's consequents the most. The ordered
scores list is also used to obtain the outputs that are associated to
these ordered scores, so we can know what are the outputs that the
agent \textit{should} evaluate to given those particular sets of
inputs. The resulting set of outputs are used to determine if the
agent is a suitable candidate; if most of the outputs associated to
the highest scores have the same direction (negative or positive),
then it is a suitable candidate. This mechanism ensures that the
chosen agents are specialized in similar inputs that yield similar
outputs. For our implementation, the highest scores have to be
associated to outputs that share the same direction at least 66\% of
the time.

\begin{equation}
  \label{equation:activation-score}
  A_{iCoA} = \dfrac{\sum_{i=1}^{N} i\mu_{A}(x) x_{i}}{\sum_{i=1}^{N}
    i\mu_{A}(x)}
\end{equation}

The optimization process for the predictive models loads configuration
files as its first step, depending on the market that we want to use
to obtain training and testing data sets. These configuration files
set parameters for the proposed method, such as the train-test ratio
and number of inputs, outputs and number of rules for the agents'
fuzzy systems.

For our implementation of the proposed method we chose Common Lisp as
our language, so we could use a software library for the creation of
intuitionistic fuzzy systems that we implemented in the past
\cite{Hernandez-Aguila2016} \cite{Hernandez-Aguila2017-2}. All the
populations are compressed and stored in a PostgreSQL database, which
enables us to resume the optimizations of the models at any
time. Storing the populations in a database also enables us to use
populations of agents to be tested in other data sets, as well as to
extract agents from certain populations to be used in other prediction
models.

% We're using Common Lisp, an implementation of an intuitionistic fuzzy system
% We're saving our populations into a database, we can create branches, we can resume experiments.
% We're compressing our populations
% We're storing different metrics: MAPE, MASE, MAE, MSE, RMSE, Recall, Precision, F1-score, Accuracy, Revenue.
% MASE is not good if using activations because it depends on the next forecast.
% Storing popluations on a PostgreSQL database.
% Each individual agent can be evaluated to know what would be its trades given a data set.
% Agents are cached to improve computation performance.

% Activations are precomputed using if-membership. Indeterminacy is taken into account.
% Activations are reduced (summed) and we choose the greatest one (the one it is more fit to react to).
% We obtain what's the "wanted direction" (buy or sell) of that trade (the one with the greatest activation).
% Then I check the activations, ordered by how well they performed for this agent.
% The next N activations must be of the same direction than the first one. Discard agent otherwise.
% If all of them pass, then the activation threshold is the one at Nth position. So in theory each agent will trade N times, most of the time.

% Inderminacy is randomly determined from 0 to 1.
% The meta-heuristic will find heuristically if indeterminacy helps or not to activate or not.
% Already mentioned in proposed method I think: We take prices to be used as the means.

% An agent won't trade unless its inputs reach certain activation threshold.
% We check every trade to see if the agent trades or not.
% In case it passes: We use each input (price) to the fuzzy system, it fires a consequent, we do union, then if-coa, we obtain the mean of all these rules.
% Required activations (consecutive winning streak or we don't accept the agent).

% In draw optimization we're either removing an agent and checking if it's better or adding a new one and check if it's better.

% For each market we load configuration files that we determined heuristically, at random.
% We have a general file which indicates the percentage to use as test set, required activations, delta-gap, how many cores to use, what provider to use.
% Begin and end of datasets, extracts rates into global variable,
% We also have per-market config files that indicate how many data points to use as training data set, number of inputs, number of rules, inputs function.
% In experiments we provide the list of configurations per market.
% If no specific configuration file is found we use a predetermined configuration.

% We represent an agent as class that has the following slots: rules, activations, activation-threshold, consecutive-activations.

% We can use a population to be tested on any market, regardless of for what market that agent was trained for.
% List preprocessing functions:

% io-closes
% io-volumes
% io-highs
% io-lows
% io-high-heights
% io-low-heights
% io-candle-heights
% io-deltas
% io-full-heights
% io-fibos
% io-stochastic-oscillator
% io-sma
% io-awma
% io-ema
% io-macd
% io-macd-signal

\section{Experiments}
\label{section:experiments}

In order to determine the efficacy of the proposed method, we designed
experiments that involved data sets and performance metrics used in
the work by Munkhdalai et al. \cite{Munkhdalai2019}. In
\cite{Munkhdalai2019}, daily prices for the following Forex markets
are used: EUR/USD, USD/JPY, USD/CHF, GBP/USD, USD/CAD and AUD/USD. The last
year of prices are used as their data set, although they do not
provide the exact starting and ending dates. Their datasets are
partitioned into three parts: training, validation and test sets,
where the training set corresponds to 80\% of the data set, the
validation set corresponds to 10\% of the data set, and the test set
correspond to 10\% of the data set. The authors used a 5-fold time
series cross-validation method to obtain their performance metrics,
which were root-mean-squared error (RMSE) and mean-absolute error (MAE).

For our experiments, we decided to use random samples of 63 trading
days---which corresponds to a quarter of the trading days in a
year---for our data sets, which can be extracted from the last 5000
natural days. These data sets are split into two parts, a
training data set which corresponds to 70\% of the data set, and a
test data set which corresponds to 30\% of the data set. As a
consequence, a validation step was not involved in our
experiments. Regarding the performance metrics, we provide results
using RMSE and MAE, in order to compare against the results presented
in \cite{Munkhdalai2019}, and we also provide results using mean
absolute percentage error (MAPE) and mean squared error (MSE). A total
of 30 experiments were performed for each forex market, and we provide
the means and standard deviations for each of our performance metrics
in Section \ref{section:results}.

In \cite{Munkhdalai2019}, the results of several predictive models are
provided. In order to obtain the hyper-parameters of the different
algorithms, random searching was used, with the exception of deep
learning neural networks (recurrent neural networks (RNN), long
short-term memory (LSTM) neural networks, and gated recurrent unit
(GRU) neural networks), where the learning rate was set at 0.001 using
the Adam optimizer \cite{kingma2014adam}, batch size at 64 instances
for each iteration, MSE as the loss function,and maximum number of
epochs at 3000 for the first fold, and then they used 300 epochs with
the first pre-trained model for the remaining folds. Regarding
multi-layer perceptrons, the authors used an input layer of 5 neurons
(for the prices of the last 5 days), a hidden layer of 16 neurons and
an output layer of 1 neuron (for the prediction of the next day's
price). In addition to neural network-based algorithms,
\cite{kingma2014adam} also provides results for models obtained by
random forest, AdaBoost, XGBoost and support-vector machines
architectures.

Our multi-agent systems were optimized for 100 iterations and the loss
function was set to be RMSE. The agents in the multi-agent systems
have to trade at least 6 out of 9 (66\%; see Section
\ref{section:implementation}) trades in the same direction, regarding
their activations. We obtained the parameters shown in Table
\ref{agents-parameters} by trial and error. In Table
\ref{agents-parameters}, $HH$ means ``high height'', and represents
the price difference between the high and the greater price between
close or open prices of a trading day; $LH$ means ``low height'', and
represents the price difference between the low and the lesser price
between close or open prices of a trading day; $CH$ means ``candle
height'' and represents the absolute price difference between the open
and close prices of a trading day; and the subscript following each of
the aforementioned abbreviations represents the number of past trading
days that were considered.

\begin{table}[]
  \caption{Multi-agent systems parameters}
  \small
  \centering
  \begin{tabular}{cccc}
    \textbf{Market} & \textbf{\# of Inputs} & \textbf{\# of Rules} & \textbf{Inputs} \\
    EUR/USD & 9 & 3 & $HH_3$, $LH_3$, $CH_3$ \\
    USD/JPY & 9 & 6 & $HH_3$, $LH_3$, $CH_3$ \\
    USD/CHF & 12 & 2 & $HH_4$, $LH_4$, $CH_4$ \\
    GBP/USD & 9 & 3 & $HH_3$, $LH_3$, $CH_3$ \\
    USD/CAD & 12 & 2 & $HH_4$, $LH_4$, $CH_4$ \\
    AUD/USD & 9 & 3 & $HH_3$, $LH_3$, $CH_3$ \\
  \end{tabular}
  \label{agents-parameters}
\end{table}

\section{Results}
\label{section:results}

\begin{table*}[t]
  \caption{Comparison MAE}
  \small
  \centering
  \begin{tabular*}{0.9\textwidth}{c @{\extracolsep{\fill}} ccccccc}
    \hline
    \textbf{Model} & \textbf{Activation function} & \textbf{EUR/USD} & \textbf{USD/JPY} & \textbf{USD/CHF} & \textbf{GBP/USD} & \textbf{USD/CAD} & \textbf{AUD/USD} \\
    \hline

          & Sigmoid & 0.0060 & 5.4000 & 0.0081 & 0.0126 & 0.0060 & 0.0079 \\
    RNN   & Swish & 0.0044 & 0.4925 & 0.0042 & 0.0074 & 0.0068 & 0.0043 \\
          & \cite{Munkhdalai2019} & 0.0043 & 0.4479 & 0.0037 & 0.0083 & 0.0047 & 0.0034 \\
    \hline
          & Cosine & 0.0098 & 2.0191 & 0.0130 & 0.0396 & 0.0106 & 0.0162 \\
    GRU   & Linear & 0.0044 & 0.4475 & 0.0041 & 0.0083 & 0.0052 & 0.0041 \\
          & \cite{Munkhdalai2019} & 0.0044 & 0.5327 & 0.0039 & 0.0062 & 0.0046 & 0.0071 \\
    \hline
          & ReLU & 0.0053 & 1.4920 & 0.0054 & 0.0101 & 0.0058 & 0.0046 \\
    LSTM  & Swish & 0.0045 & 0.5243 & 0.0049 & 0.0065 & 0.0063 & 0.0054 \\
          & \cite{Munkhdalai2019} & 0.0046 & 0.5200 & 0.0060 & 0.0069 & 0.0061 & 0.0044 \\
    \hline

          & ReLU & 0.0049 & 0.7499 & 0.0058 & 0.0150 & 0.0052 & 0.0038 \\
    MLP   & Swish & 0.0043 & 0.7351 & 0.0039 & 0.0073 & 0.0055 & 0.0042 \\
          & \cite{Munkhdalai2019} & 0.0047 & 0.6114 & 0.0059 & 0.0066 & 0.0049 & 0.0041 \\
          

    \hline

    \multicolumn{2}{l}{Random forest} & 0.0053 & 0.5209 & 0.0061 & 0.0156 & 0.0059 & 0.0044 \\
    \multicolumn{2}{l}{AdaBoost} & 0.0059 & 0.6440 & 0.0103 & 0.0158 & 0.0063 & 0.0066 \\
    \multicolumn{2}{l}{XGBoost} & 0.0059 & 0.4958 & 0.0048 & 0.0156 & 0.0064 & 0.0045 \\
    \multicolumn{2}{l}{SVM} & 0.0304 & 0.4718 & 0.0376 & 0.0294 & 0.0099 & 0.0176 \\
    
    \multicolumn{2}{l}{Ours without AF}        & 0.0050 & 0.4903 & 0.0041 & 0.0073 & 0.0050 & 0.0048 \\
    \multicolumn{2}{l}{Ours with AF}           & 0.0033 & 0.1810 & 0.0019 & 0.0038 & 0.0033 & 0.0027 \\
    \multicolumn{2}{l}{Ours with AF as weight} & 0.0044 & 0.4122 & 0.0036 & 0.0069 & 0.0042 & 0.0044 \\

    \hline

  \end{tabular*}
\end{table*}

\begin{table*}[t]
  \caption{Comparison RMSE}
  \small
  \centering
  \begin{tabular*}{0.9\textwidth}{c @{\extracolsep{\fill}} ccccccc}
    \hline
    \textbf{Model} & \textbf{Activation function} & \textbf{EUR/USD} & \textbf{USD/JPY} & \textbf{USD/CHF} & \textbf{GBP/USD} & \textbf{USD/CAD} & \textbf{AUD/USD} \\
    \hline

           & Sigmoid & 0.0079 & 6.0677 & 0.0097 & 0.0188 & 0.0075 & 0.0090 \\
    RNN    & Swish & 0.0059 & 0.6435 & 0.0062 & 0.0099 & 0.0085 & 0.0054 \\
           & \cite{Munkhdalai2019} & 0.0057 & 0.5993 & 0.0059 & 0.0098 & 0.0062 & 0.0045 \\

    \hline

           & Cosine & 0.0129 & 2.6072 & 0.0168 & 0.0548 & 0.0133 & 0.0187 \\
    GRU    & Linear & 0.0058 & 0.6054 & 0.0061 & 0.0104 & 0.0066 & 0.0052 \\
           & \cite{Munkhdalai2019} & 0.0059 & 0.6871 & 0.0060 & 0.0083 & 0.0060 & 0.0082 \\

    \hline

           & ReLU & 0.0069 & 1.6890 & 0.0079 & 0.0155 & 0.0074 & 0.0058 \\
    LSTM   & Swish & 0.0061 & 0.6890 & 0.0072 & 0.0088 & 0.0081 & 0.0069 \\
           & \cite{Munkhdalai2019} & 0.0062 & 0.6757 & 0.0087 & 0.0092 & 0.0078 & 0.0055 \\
    
    \hline

           & ReLU & 0.0064 & 0.9711 & 0.0081 & 0.0217 & 0.0066 & 0.0048 \\
    MLP    & Swish & 0.0058 & 0.9360 & 0.0061 & 0.0097 & 0.0070 & 0.0054 \\
           & \cite{Munkhdalai2019} & 0.0061 & 0.7722 & 0.0082 & 0.0088 & 0.0064 & 0.0053 \\

    \hline

    \multicolumn{2}{l}{Random forest} & 0.0068 & 0.6781 & 0.0081 & 0.0244 & 0.0075 & 0.0056 \\
    \multicolumn{2}{l}{AdaBoost} & 0.0076 & 0.8198 & 0.0136 & 0.0238 & 0.0080 & 0.0082 \\
    \multicolumn{2}{l}{XGBoost} & 0.0076 & 0.6554 & 0.0071 & 0.0241 & 0.0085 & 0.0058 \\
    \multicolumn{2}{l}{SVM} & 0.0332 & 0.6387 & 0.0394 & 0.0329 & 0.0125 & 0.0200 \\

    \multicolumn{2}{l}{Ours without AF}        & 0.0057 & 0.5391 & 0.0047 & 0.0079 & 0.0057 & 0.0052 \\
    \multicolumn{2}{l}{Ours with AF}           & 0.0071 & 0.5630 & 0.0051 & 0.0078 & 0.0057 & 0.0058 \\
    \multicolumn{2}{l}{Ours with AF as weight} & 0.0052 & 0.4625 & 0.0042 & 0.0084 & 0.0047 & 0.0050 \\

    \hline

  \end{tabular*}
\end{table*}

\begin{table*}[t]
  \caption{Multi-agent system without activation functions}
  \small
  \centering
  \begin{tabular*}{0.9\textwidth}{c @{\extracolsep{\fill}} ccccccc}
    \hline
    \multicolumn{2}{c}{\textbf{Metric}} & \textbf{EUR/USD} & \textbf{USD/JPY} & \textbf{USD/CHF} & \textbf{GBP/USD} & \textbf{USD/CAD} & \textbf{AUD/USD} \\
    \hline
    \multirow{2}{*}{MAE} & Mean & 5.03\e{-03} & 4.90\e{-01} & 4.13\e{-03} & 7.34\e{-03} & \e{-03} & \e{-03} \\
                      & Std dev & 2.79\e{-03} & 2.20\e{-01} & 1.94\e{-03} & 4.01\e{-03} & \e{-03} & \e{-03} \\
    \hline
    \multirow{2}{*}{MAPE} & Mean & 4.49\e{-03} & 2.89\e{-01} & 3.70\e{-03} & \e{-03} & \e{-03} & \e{-03} \\
                       & Std dev & 2.47\e{-03} & 1.01\e{-01} & 1.73\e{-03} & \e{-03} & \e{-03} & \e{-03} \\
    \hline
    \multirow{2}{*}{MSE} & Mean & 4.20\e{-05} & 3.52\e{-01} & 2.76\e{-05} & \e{-03} & \e{-03} & \e{-03} \\
                      & Std dev & 5.01\e{-05} & 3.37\e{-01} & 2.98\e{-05} & \e{-03} & \e{-03} & \e{-03} \\
    \hline
    \multirow{2}{*}{RMSE} & Mean & 5.69\e{-03} & 5.39\e{-01} & 4.69\e{-03} & \e{-03} & \e{-03} & \e{-03} \\
                       & Std dev & 3.18\e{-03} & 2.51\e{-01} & 2.09\e{-03} & \e{-03} & \e{-03} & \e{-03} \\
    
    \hline
  \end{tabular*}
\end{table*}

\begin{table*}[t]
  \caption{Multi-agent system with binary activation functions}
  \small
  \centering
  \begin{tabular*}{0.9\textwidth}{c @{\extracolsep{\fill}} ccccccc}
    \hline
    \multicolumn{2}{c}{\textbf{Metric}} & \textbf{EUR/USD} & \textbf{USD/JPY} & \textbf{USD/CHF} & \textbf{GBP/USD} & \textbf{USD/CAD} & \textbf{AUD/USD} \\
    \hline
    \multirow{2}{*}{MAE} & Mean & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
                      & Std dev & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
    \hline
    \multirow{2}{*}{MAPE} & Mean & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
                       & Std dev & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
    \hline
    \multirow{2}{*}{MSE} & Mean & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
                      & Std dev & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
    \hline
    \multirow{2}{*}{RMSE} & Mean & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
                       & Std dev & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\

    \hline
  \end{tabular*}
\end{table*}

\begin{table*}[t]
  \caption{Multi-agent system with activation functions as weights}
  \small
  \centering
  \begin{tabular*}{0.9\textwidth}{c @{\extracolsep{\fill}} ccccccc}
    \hline
    \multicolumn{2}{c}{\textbf{Metric}} & \textbf{EUR/USD} & \textbf{USD/JPY} & \textbf{USD/CHF} & \textbf{GBP/USD} & \textbf{USD/CAD} & \textbf{AUD/USD} \\
    \hline
    \multirow{2}{*}{MAE} & Mean & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
                      & Std dev & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
    \hline
    \multirow{2}{*}{MAPE} & Mean & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
                       & Std dev & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
    \hline
    \multirow{2}{*}{MSE} & Mean & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
                      & Std dev & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
    \hline
    \multirow{2}{*}{RMSE} & Mean & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\
                       & Std dev & \e{-03} & \e{-01} & \e{-03} & \e{-03} & \e{-03} & \e{-03} \\

    \hline
  \end{tabular*}
  \label{table:full-results-weights}
\end{table*}

\section{Conclusion}
\label{section:conclusion}

\section{Future Work}
\label{section:future-work}

% We could implement a distributed algorithm

\section*{Acknowledgment}

\begin{IEEEbiography}[{\includegraphics[width=1in,height=1.25in,clip,keepaspectratio]{img/amaury-1by1half-in.png}}]{Amaury
  Hernandez-Aguila} 
\end{IEEEbiography}

\bibliography{bibliography}
\bibliographystyle{IEEEtran}

\EOD

\end{document}
